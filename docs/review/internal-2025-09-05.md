## 全体内部レビュー（2025-09-05）

### 概要
- 対象: ドメイン（Board/Score/GameState/7-bag/SRS）、アプリ（Session Service）、Web/API（start/input/state/delete, v0.2〜v0.4）、UI（v0.5〜v0.7）、ドキュメント/テスト。

### 良い点
- オニオン方針に沿った層分離とMVPの段階的実装（TDD主体）。
- Web/APIはETag/If-MatchとIdempotency-Keyで基本の整合性担保を実装済み。
- UIは最小要素で操作可能・cellTypes拡張で色マッピングに対応。

### リスク/課題
- カバレッジ: Jacoco 実測 line≈76.4% / branch≈76.4%（目標95%未達）。
- GameState: rotate/hold/tick/score反映 未実装。ロック遅延仕様も未配線。
- Score連動: line clear/soft/hard/コンボ/ステージ倍率の加点がGameStateに未統合。
- Board: ロックブロックの型保持が未導入（UI側はcellTypes受け入れ準備済み）。
- CI: GitHub Actions 等のCI未設定（しきい値検証/Spotless/テスト実行がローカル依存）。
- 冪等性キーの保持・クリーニング方針が未定（現状メモリ保持のみ）。

### 機能観点（層別）
- domain
  - Board.placeAndClear: 単行〜複数行消去・下詰めはOK。境界/全行/交互などの網羅テストを強化推奨。
  - ScoreRule: 基本点/コンボ係数は明確。B2B/ステージ倍率の適用点は追補要。
  - GameState: 入力の純粋遷移方針は良いが、未実装の主要操作（rotate/tick/hold/score融合）が残存。
- application
  - GameSessionService: in-memoryで十分。Idempotency実装は明快。キー保持期間/掃除方針は要決定。
- web
  - 404/409/400のエラーポリシーが明確。DTOは将来拡張に備え済み。
- ui
  - MVP要件を満たす。アクセシビリティ/凡例/高コントラスト等は今後強化余地。

### セキュリティ/運用
- 現状は開発用の想定でOK。将来的にCSRF/Rate-limit/認証方針を定める。

### 優先度付き改善（概要）
- P0: rotate/tick/hold/score統合、カバレッジ95%到達、CI導入、Board型保持。
- P1: Web/APIテスト（Controller単体/JSON整合）、UIアクセシビリティ、Idempotency戦略のドキュメント化。
- P2: SSE/描画最適化、永続化層、設定画面（難易度/ステージ）など。

詳細タスクは `docs/improvements/todo-2025-09-05.md` 参照。

